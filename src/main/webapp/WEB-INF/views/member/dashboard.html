<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:insert="~{fragments :: common-head}"></div>
    <title>HealthHub@UTM : Member Dashboard</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background-color: #f6f8fb; 
            padding: 20px; 
        }
        .container-custom { 
            max-width: 1100px; 
            margin: 0 auto; 
        }
        h1 { 
            font-weight: 700;
            color: #17477c; 
            margin-bottom: 20px; 
        }
        .info-card {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .card-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #007bff; 
        }
        .card-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .card-value {
            font-size: 2.5em;
            font-weight: bold;
        }
        .link-button {
            margin-top: 15px;
        }
        .card-enrollment .card-icon { color: #28a745; }
        .card-plan .card-icon { color: #ffc107; }
        .card-programs .card-icon { color: #17a2b8; }

    </style>
</head>
<body>

    <div th:replace="~{fragments :: main-menu}"></div>
    
    <div class="container mt-4">
        <div th:replace="~{fragments :: flash-messages}"></div>


<div class="container-custom">
<h1 th:text="'Welcome Back, ' + ${session.username ?: 'Member'} + '!'">Welcome Back, Member!</h1>    <p class="text-muted mb-4">Your personalized health and fitness summary.</p>

    <div class="row">
        
        <div class="col-md-4 mb-4">
    <div class="info-card card-enrollment">
        <div>
            <i class="fas fa-calendar-check card-icon"></i>
            <div class="card-title">My Enrollments</div>
            
            <div class="card-value text-success" th:text="${activeEnrollments}">0</div> 
            <p class="text-muted">Active Programs</p>
            
            <p class="text-warning mb-0" th:if="${pendingPayments > 0}">
                Payment for <span th:text="${pendingPayments}">0</span> program(s) is pending.
            </p>
            <p class="text-success mb-0" th:unless="${pendingPayments > 0}">
                All payments up to date!
            </p>
        </div>
        <a th:href="@{/member/enrollments}" class="btn btn-success link-button">View My Enrollments</a>
    </div>
</div>

<div class="col-md-4 mb-4">
    <div class="info-card card-plan">
        <div>
            <i class="fas fa-dumbbell card-icon"></i>
            <div class="card-title">Current Workout Plan</div>
            
            <div th:if="${activePlan != null}">
                <div class="card-value text-warning">Active</div>
                <p class="text-muted" th:text="'&quot;' + ${activePlan.name} + '&quot;'">Plan Name</p>
                <p class="text-secondary mb-0">
                    Assigned by Trainer: <span th:text="${activePlan.trainer != null ? activePlan.trainer.name : 'N/A'}">Trainer</span>
                </p>
            </div>
            <div th:unless="${activePlan != null}">
                <div class="card-value text-muted">None</div>
                <p class="text-muted">No active workout plan assigned</p>
            </div>
        </div>
        <a th:href="@{/member/workout-plans}" class="btn btn-warning link-button">Go to Workout Plans</a>
    </div>
</div>

<div class="col-md-4 mb-4">
    <div class="info-card card-programs">
        <div>
            <i class="fas fa-list-alt card-icon"></i>
            <div class="card-title">Explore Programs</div>
            
            <div class="card-value text-info" th:text="${totalPrograms}">0</div> 
            <p class="text-muted">Total Active Programs Available</p>

            <p class="text-secondary mb-0">Find your next fitness challenge.</p>
        </div>
        <a th:href="@{/member/programs}" class="btn btn-info link-button">Browse All Programs</a>
    </div>
</div>


<div class="col-md-4 mb-4">
    <div class="info-card card-bmi">
        <div>
            <i class="fas fa-weight card-icon"></i>
            <div class="card-title">My BMI Status</div>
            
            <div th:if="${latestBmi != null}">
                <div class="card-value text-info" 
                     th:text="${#numbers.formatDecimal(latestBmi.bmi, 1, 2)}">24.5</div>
                <p class="text-muted" th:text="${latestBmi.category}">Normal Weight</p>
                <p class="text-secondary mb-0">
                    Total Records: <span th:text="${bmiRecordCount}">5</span>
                </p>
            </div>
            <div th:unless="${latestBmi != null}">
                <div class="card-value text-muted">No Data</div>
                <p class="text-muted">Calculate your first BMI</p>
            </div>
        </div>
        <a th:href="@{/bmi/form}" class="btn btn-info link-button">Calculate BMI</a>
    </div>
</div>
        
    </div>

</div>

<script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>